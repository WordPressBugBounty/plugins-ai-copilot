/*! For license information please see index.js.LICENSE.txt */
(()=>{var e={500(e,t){var n;!function(){"use strict";var a={}.hasOwnProperty;function o(){for(var e="",t=0;t<arguments.length;t++){var n=arguments[t];n&&(e=l(e,i(n)))}return e}function i(e){if("string"==typeof e||"number"==typeof e)return e;if("object"!=typeof e)return"";if(Array.isArray(e))return o.apply(null,e);if(e.toString!==Object.prototype.toString&&!e.toString.toString().includes("[native code]"))return e.toString();var t="";for(var n in e)a.call(e,n)&&e[n]&&(t=l(t,n));return t}function l(e,t){return t?e?e+" "+t:e+t:e}e.exports?(o.default=o,e.exports=o):void 0===(n=function(){return o}.apply(t,[]))||(e.exports=n)}()}},t={};function n(a){var o=t[a];if(void 0!==o)return o.exports;var i=t[a]={exports:{}};return e[a](i,i.exports,n),i.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";const e=window.wp.element,t=window.aicp.helpers,a=window.wp.i18n,o=window.aicp.components;function i({}){return(0,e.createElement)(o.ItemTooltip,null,(0,e.createElement)("h3",null,(0,a.__)("Content","ai-copilot")),(0,e.createElement)("p",null,(0,a.__)("This module enables you to create or review content for any post type. Upon activation, a new metabox appears in the post editor interface.","ai-copilot")),(0,e.createElement)("hr",null),(0,e.createElement)(o.ItemTip,null,(0,e.createElement)("b",null,(0,a.__)("Create: ","ai-copilot")),(0,a.__)("This panel found in new posts, assists you in generating content on a chosen topic.","ai-copilot")),(0,e.createElement)(o.ItemTip,null,(0,e.createElement)("b",null,(0,a.__)("Review: ","ai-copilot")),(0,a.__)("This panel found in posts with existing content, helping you to review and enhance the material.","ai-copilot")),(0,e.createElement)("hr",null),(0,e.createElement)("p",null,(0,e.createInterpolateElement)((0,a.__)("For more information, please check the documentation <a>here</a>.","ai-copilot"),{a:(0,e.createElement)("a",{href:"https://quadlayers.com/documentation/ai-copilot/?utm_source=aicp_plugin&utm_medium=admin_modal&utm_campaign=documentation&utm_content=documentation_link",target:"_blank",rel:"noreferrer"})})))}function l(){return l=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)({}).hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},l.apply(null,arguments)}const r=window.aicp.icons,s=({onClick:t})=>(0,e.createElement)("div",{className:"aicp__flex",style:{gap:0}},(0,e.createElement)("button",{className:"aicp__editor-button button button-primary",onClick:e=>{e.preventDefault(),t()}},(0,e.createElement)(r.Copilot,null),(0,a.__)("AI Panel","ai-copilot")),(0,e.createElement)(i,null)),c=t=>{const[n,i]=(0,e.useState)(!1);return(0,e.createElement)(e.Fragment,null,(0,e.createElement)("p",null,(0,a.__)("Unlock the potential of AI-enhanced content creation with our AI Panel.","ai-copilot")),(0,e.createElement)("hr",null),(0,e.createElement)(s,{onClick:()=>i(!0)}),(0,e.createElement)(o.AIPanel,l({},t,{isModalOpen:n,onClose:()=>i(!1)})),(0,e.createElement)("hr",null),(0,e.createElement)(o.ItemTip,null,(0,e.createInterpolateElement)((0,a.__)("For more information, please check the documentation <a>here</a>.","ai-copilot"),{a:(0,e.createElement)("a",{href:"https://quadlayers.com/documentation/ai-copilot/?utm_source=aicp_plugin&utm_medium=admin_modal&utm_campaign=documentation&utm_content=documentation_link",target:"_blank",rel:"noreferrer"})})))},p=window.aicp.hooks,m=window.aicp["api-services"],_=window.wp.components;var d=n(500),u=n.n(d);const g=({shift:t=!0,offset:n=5,initialOpen:a=!1,preventClose:o=!1,disabled:i,text:l="",displayDefaultPopoverContainer:s=!0,hideIcon:c=!1,children:p,className:m,placement:d="right",noArrow:g=!1})=>{const[E,h]=(0,e.useState)(a),f=()=>{o||h(!1)};return 0===p?.props?.children?.length?null:(0,e.createElement)("div",{className:u()("aicp__components__tooltip",m,i&&"aicp__components__tooltip--disabled")},(0,e.createElement)("div",{className:"aicp__components__tooltip__button",onMouseEnter:()=>{i||h(!0)}},!!l&&(0,e.createElement)("span",{className:"aicp__components__tooltip__button__text"},l),!c&&(0,e.createElement)(r.Ask,null)),E&&(0,e.createElement)(_.Popover,{shift:t,offset:n,noArrow:g,placement:d||void 0,focusOnMount:"false",className:u()("aicp__components__tooltip__popover",m&&m+"__popover"),onClose:f,onMouseLeave:f},s?(0,e.createElement)("div",null,p):p))};function E({label:t,help:n,className:a=""}){return(0,e.createElement)("span",{className:u()("aicp__components__label",a)},t,n&&(0,e.createElement)(g,null,(0,e.createElement)("p",null,n)))}function h(t){const{name:n,values:o,onChange:i}=t;return(0,e.createElement)(_.TextareaControl,{label:(0,e.createElement)(E,{label:(0,a.__)("Topic:","ai-copilot"),help:(0,a.__)("Specify the main topic and guidelines for creating the content.","ai-copilot")}),placeholder:(0,a.__)("Please indicate the topic.","ai-copilot"),value:o?.topic,onChange:e=>i(n,e),help:!o?.topic&&(0,a.__)("Topic is required.","ai-copilot"),className:!o?.topic&&"aicp__field--required"})}function f({fields:n,values:o,onChange:i,isTopicRequired:l,sectionCountisVisible:r=!0,paragraphCountisVisible:s=!0,wordCountisVisible:c=!0,setCurrentInstanceFields:p}){const{variables_language:d=t.WP_LANGUAGE_NAME,variables_style:u,variables_tone:g,variables_section_count:f,variables_paragraph_count:b,variables_word_count:v,model:C}=o,[T,I]=(0,e.useState)(!1),N=e=>t=>i({...o,[e]:t});return(0,e.useEffect)(()=>{const{maxTokens:e}=m.OPENAI_MODELS.find(e=>e.model===C),a=(0,t.isTokenLimitExceeded)({content:n?.content,wordCount:v,maxTokens:e});I(a)},[C,v]),(0,e.createElement)(e.Fragment,null,l&&(0,e.createElement)(h,{name:"topic",values:n,onChange:(e,t)=>{p({[e]:t})}}),r&&(0,e.createElement)(_.RangeControl,{label:(0,a.__)("Number of Sections:","ai-copilot"),value:f,onChange:N("variables_section_count"),min:1,max:10,disabled:!(0,t.isUsedReplacement)(o,"SECTIONS_COUNT"),help:!(0,t.isUsedReplacement)(o,"SECTIONS_COUNT")&&(0,a.__)("To allow this setting include {SECTIONS_COUNT} in your prompts.","ai-copilot")}),s&&(0,e.createElement)(_.RangeControl,{label:(0,a.__)("Number of Paragraphs per Section:","ai-copilot"),value:b,onChange:N("variables_paragraph_count"),min:1,max:10,disabled:!(0,t.isUsedReplacement)(o,"PARAGRAPHS_PER_SECTION"),help:!(0,t.isUsedReplacement)(o,"PARAGRAPHS_PER_SECTION")&&(0,a.__)("To allow this setting include {PARAGRAPHS_PER_SECTION} in your prompts.","ai-copilot")}),c&&(0,e.createElement)(_.RangeControl,{label:(0,a.__)("Number of Words:","ai-copilot"),value:v,onChange:N("variables_word_count"),min:1,max:1e4,disabled:!(0,t.isUsedReplacement)(o,"WORD_LENGTH"),help:!(0,t.isUsedReplacement)(o,"WORD_LENGTH")&&(0,a.__)("To allow this setting include {WORD_LENGTH} in your prompts.","ai-copilot")||T&&(0,a.__)("The number of words exceeds the maximum tokens of the model.","ai-copilot"),className:T&&"aicp__field--required"}),(0,e.createElement)(_.SelectControl,{label:(0,a.__)("Language:","ai-copilot"),value:d,options:t.OPTIONS_LANGUAGE,onChange:N("variables_language"),disabled:!(0,t.isUsedReplacement)(o,"LANGUAGE"),help:!(0,t.isUsedReplacement)(o,"LANGUAGE")&&(0,a.__)("To allow this setting include {LANGUAGE} in your prompts.","ai-copilot")}),(0,e.createElement)(_.SelectControl,{label:(0,e.createElement)(E,{label:(0,a.__)("Style:","ai-copilot"),help:(0,a.__)("Select the trait for the response. For instance, if you're seeking for convincing response, choose the 'argumtentative' option. ","ai-copilot\t")}),value:u,options:t.OPTIONS_TEXT_STYLE,onChange:N("variables_style"),disabled:!(0,t.isUsedReplacement)(o,"WRITING_STYLE"),help:!(0,t.isUsedReplacement)(o,"WRITING_STYLE")&&(0,a.__)("To allow this setting include {WRITING_STYLE} in your prompts.","ai-copilot")}),(0,e.createElement)(_.SelectControl,{label:(0,e.createElement)(E,{label:(0,a.__)("Tone:","ai-copilot"),help:(0,a.__)("Select the desired expression for the response. For instance, if you're seeking for a serious response, choose the 'professional' option. ","ai-copilot\t")}),value:g,options:t.OPTIONS_TEXT_TONE,onChange:N("variables_tone"),disabled:!(0,t.isUsedReplacement)(o,"WRITING_TONE"),help:!(0,t.isUsedReplacement)(o,"WRITING_TONE")&&(0,a.__)("To allow this setting include {WRITING_TONE} in your prompts.","ai-copilot")}))}function b(n){const{values:o,onChange:i,fields:l,allowPreview:r=!1}=n,[s,c]=(0,e.useState)(r),{prompt_system:p,prompt_title:m,prompt_sections:d,prompt_content:u,prompt_excerpt:g,prompt_tags:E,variables_language:h,variables_style:f,variables_tone:b,variables_section_count:v,variables_paragraph_count:C,variables_word_count:T}=o,I={TOPIC:l.topic,TITLE:l.title,SECTIONS:l.sections,CONTENT:l.content,EXCERPT:l.excerpt,TAGS:l.tags,SECTIONS_COUNT:v,PARAGRAPHS_PER_SECTION:C,WORD_LENGTH:T,LANGUAGE:h,WRITING_STYLE:f,WRITING_TONE:b},N=e=>t=>{i({...o,[e]:t})},y=!p||/^\s*$/.test(p);return(0,e.createElement)(e.Fragment,null,r&&(0,e.createElement)(_.ToggleControl,{label:(0,a.__)("Preview","ai-copilot"),help:(0,a.__)("Display the resulting prompt, with all variables replaced.","ai-copilot"),checked:s,onChange:c}),(0,e.createElement)(_.TextareaControl,{label:(0,a.__)("Instructions:","ai-copilot"),help:y&&(0,a.__)("Instructions is required","ai-copilot"),className:y&&"aicp__field--required",value:p,disabled:s,onChange:N("prompt_system")}),(0,e.createElement)(_.TextareaControl,{label:(0,a.__)("Prompt Title:","ai-copilot"),help:!m&&(0,a.__)("Prompt is required","ai-copilot"),className:!m&&"aicp__field--required",value:s?(0,t.promptReplacement)(m,I):m,disabled:s,onChange:N("prompt_title")}),(0,e.createElement)(_.TextareaControl,{label:(0,a.__)("Prompt Sections:","ai-copilot"),help:!d&&(0,a.__)("Prompt is required","ai-copilot"),className:!d&&"aicp__field--required",value:s?(0,t.promptReplacement)(d,I):d,disabled:s,onChange:N("prompt_sections")}),(0,e.createElement)(_.TextareaControl,{label:(0,a.__)("Prompt Content:","ai-copilot"),help:!u&&(0,a.__)("Prompt is required","ai-copilot"),className:!u&&"aicp__field--required",value:s?(0,t.promptReplacement)(u,I):u,disabled:s,onChange:N("prompt_content")}),(0,e.createElement)(_.TextareaControl,{label:(0,a.__)("Prompt Excerpt:","ai-copilot"),help:!g&&(0,a.__)("Prompt is required","ai-copilot"),className:!g&&"aicp__field--required",value:s?(0,t.promptReplacement)(g,I):g,disabled:s,onChange:N("prompt_excerpt")}),(0,e.createElement)(_.TextareaControl,{label:(0,a.__)("Prompt Tags:","ai-copilot"),help:!E&&(0,a.__)("Prompt is required","ai-copilot"),className:!E&&"aicp__field--required",value:s?(0,t.promptReplacement)(E,I):E,disabled:s,onChange:N("prompt_tags")}))}function v({children:t,disabled:n=!1,error:a=!1}){return(0,e.createElement)("div",{className:u()("aicp__item-response",a&&"aicp__field--required")},(0,e.createElement)(_.Disabled,{isDisabled:n},t))}function C({className:t,hideText:n=!1,text:o=(0,a.__)("Loading…","ai-copilot"),isPositionAbsolute:i=!1}){return(0,e.createElement)("div",{className:u()("aicp__components__spinner",i&&"aicp__components__spinner--absolute",t)},(0,e.createElement)("span",{style:{visibility:"visible"},className:"spinner"}),!n&&o)}function T(t){const{value:n,label:o,loading:i,error:l,onWriteField:r,onFetchField:s,disabledWriteField:c}=t;return(0,e.createElement)(e.Fragment,null,o,i&&(0,e.createElement)("div",{className:"aicp__item-response__label__spinner"},(0,e.createElement)(C,null)),(0,e.createElement)("div",null,!i&&!!s&&(0,e.createElement)("a",{href:"#",className:"aicp__item-response__label__button",onClick:e=>{e.preventDefault(),s()}},(0,a.__)("Create","ai-copilot")),!i&&!l&&!!r&&!!n&&(0,e.createElement)("a",{href:"#",className:u()("aicp__item-response__label__button",c&&"aicp__item-response__label__button--disabled"),onClick:e=>{e.preventDefault(),r()}},(0,a.__)("Write","ai-copilot"))))}function I(t){const{help:n,value:a,name:o,onChange:i,disabled:l}=t;return(0,e.createElement)(v,t,(0,e.createElement)(_.TextControl,{label:(0,e.createElement)(T,t),help:n,value:a,disabled:l,onChange:e=>i(o,e)}))}function N(t){const{help:n,value:a,name:o,rows:i=4,onChange:l,disabled:r}=t;return(0,e.createElement)(v,t,(0,e.createElement)(_.TextareaControl,{label:(0,e.createElement)(T,t),rows:i,help:n,value:a,disabled:r,onChange:e=>l(o,e)}))}function y({images:t,onChange:n=()=>{}}){const[a,o]=(0,e.useState)(0),[i,l]=(0,e.useState)(!1),s=(0,e.useRef)(null),c=e=>a=>{a.preventDefault(),o(e),n(t[e])},p=()=>{s.current&&!s.current.complete&&(s.current.style.display="none",l(!0),s.current.onload=()=>{s.current&&(s.current.style.display="block"),l(!1)})};return(0,e.useEffect)(()=>{o(0),p(),t.length>0&&n(t[0])},[JSON.stringify(t)]),(0,e.useEffect)(()=>{p()},[a]),(0,e.createElement)("div",{className:"aicp__carousel-images"},t?.length?(0,e.createElement)(e.Fragment,null,i&&(0,e.createElement)(C,{hideText:!0}),(0,e.createElement)("img",{ref:s,className:"aicp__carousel-images__image",src:t[a]}),(0,e.createElement)("div",{className:"aicp__carousel-images__controls-container"},(0,e.createElement)("span",{className:`dashicons dashicons-arrow-left aicp__carousel-images__control-left ${0===a&&"aicp__carousel-images__control-left--disabled"}`,onClick:c(a-1)}),(0,e.createElement)("span",null,`${a+1}/${t.length}`),(0,e.createElement)("span",{className:`dashicons dashicons-arrow-right aicp__carousel-images__control-right ${a===t.length-1&&"aicp__carousel-images__control-right--disabled"}`,onClick:c(a+1)}))):(0,e.createElement)("div",{className:"aicp__carousel-images__image"},(0,e.createElement)(r.ImagePlaceholder,null)))}function w(t){const{name:n,images:a,onChange:o}=t;return(0,e.createElement)(v,t,(0,e.createElement)(_.BaseControl,{className:"aicp__premium-field",id:"image_field",label:(0,e.createElement)(T,t)},(0,e.createElement)(y,{images:a,onChange:e=>o(n,e)})))}function x({values:n,onChange:o,onWriteTitle:i,onWriteContent:l,onWriteExcerpt:r,onWriteTags:s,onWriteImage:c,onFetchFieldTitle:m,onFetchFieldSections:_,onFetchFieldContent:d,onFetchFieldExcerpt:u,onFetchFieldTags:g,onFetchFieldImages:E,allowWrite:f=!0}){const b=document.getElementById("post_type")?.value,{post:v}=(0,p.usePost)((0,t.getCurrentPostId)(),b),[C,T]=(0,e.useState)({title:!1,content:!1,excerpt:!1,tags:!1,image:!1}),y=(e,t)=>{T(n=>({...n,[e]:t}))},x=(e,n,...o)=>async()=>{y(e,!0);try{await n(...o)}finally{y(e,!1),(0,t.createNotice)((0,a.sprintf)((0,a.__)("%s updated.","ai-copilot"),e[0].toUpperCase()+e.slice(1).toLowerCase()))}},S=Object.values({isTitleLoading:n.isTitleLoading,isContentLoading:n.isContentLoading,isExcerptLoading:n.isExcerptLoading,isTagsLoading:n.isTagsLoading,isSectionsLoading:n.isSectionsLoading,isImagesLoading:n.isImagesLoading}).some(Boolean),P=x("title",i,n.title),F=x("content",l,n.content),R=x("excerpt",r,n.excerpt),O=x("tags",s,n.tags),L=x("image",c,n.images.find(e=>e.isFeatured)?.src,n.image_position,n.images.find(e=>e.isFeatured)?.caption||"",n.images.find(e=>e.isFeatured)?.base64||""),A=n.images.find(e=>e.isFeatured)?.src,W=(0,t.isUsedReplacement)(n,"TOPIC");return(0,e.createElement)("div",{className:"aicp__modal__flex"},W&&(0,e.createElement)("div",{className:"aicp__modal__flex__column0"},(0,e.createElement)(h,{name:"topic",values:n,onChange:o})),(0,e.createElement)("div",{className:"aicp__modal__flex__column2"},(0,e.createElement)(I,{label:(0,a.__)("Title","ai-copilot"),value:n.title,name:"title",error:n.isTitleError,disabled:S||C.title,loading:n.isTitleLoading||C.title,onWriteField:f&&P,disabledWriteField:v?.title===n.title,onChange:o,onFetchField:m}),(0,e.createElement)(N,{label:(0,a.__)("Sections","ai-copilot"),value:n.sections,name:"sections",error:n.isSectionsError,disabled:S,loading:n.isSectionsLoading,onChange:o,onFetchField:_}),(0,e.createElement)(N,{rows:12,label:(0,a.__)("Content","ai-copilot"),value:n.content,name:"content",error:n.isContentError,disabled:S,loading:n.isContentLoading||C.content,onWriteField:f&&F,onChange:o,onFetchField:d})),(0,e.createElement)("div",{className:"aicp__modal__flex__column1"},(0,e.createElement)(N,{label:(0,a.__)("Excerpt","ai-copilot"),value:n.excerpt,name:"excerpt",error:n.isExcerptError,disabled:S,loading:n.isExcerptLoading||C.excerpt,onWriteField:f&&R,disabledWriteField:v?.excerpt===n.excerpt,onChange:o,onFetchField:u}),"post"===b&&(0,e.createElement)(I,{label:(0,a.__)("Tags","ai-copilot"),value:n.tags,name:"tags",error:n.isTagsError,disabled:S,loading:n.isTagsLoading||C.tags,onWriteField:f&&O,disabledWriteField:(()=>{const e=v?.tagNames||[],t=n.tags.replace(/, /g,",").split(",");return!!v?.tags?.length&&[...e].sort().every((e,n)=>e===[...t].sort()[n])})(),onChange:o,onFetchField:g}),(0,e.createElement)(w,{label:(0,e.createElement)(e.Fragment,null,(0,e.createElement)("span",{className:"aicp__premium-badge",style:{marginLeft:"5px"}}),(0,a.__)("Image","ai-copilot")),value:A,images:n.images.map(e=>e.src),name:"image",error:n.isImagesError,disabled:S||t.AICP_IS_FREE,loading:n.isImagesLoading||C.image,onWriteField:f&&L,disabledWriteField:v?.featured_image_url===A,onChange:o,onFetchField:E})))}const S=[{label:(0,a.__)("Variables","ai-copilot"),name:"variables",component:n=>{const{panel:o}=n,{instances:i,selectedInstanceId:l,setCurrentInstanceFields:r,setCurrentInstanceSettings:s}=o,{settings:c,fields:p}=i[l],m=(0,t.isUsedReplacement)(c,"TOPIC");return(0,e.createElement)("div",{className:"aicp__modal__flex"},(0,e.createElement)("div",{className:"aicp__modal__flex__column0"},(0,e.createElement)("h2",null,(0,a.__)("Set up generation prompt variables.","ai-copilot")),(0,e.createElement)(f,{isTopicRequired:m,fields:p,values:c,setCurrentInstanceFields:r,onChange:s})))},validate:(e,n,a)=>!!((e.topic||!(0,t.isUsedReplacement)(n,"TOPIC"))&&n.prompt_content&&n.prompt_excerpt&&n.prompt_sections&&n.prompt_tags&&n.prompt_title&&n.prompt_system)},{label:(0,a.__)("Preview","ai-copilot"),name:"preview",component:t=>{const{panel:n}=t,{setCurrentInstanceSettings:o,selectedInstanceId:i,instances:l}=n,{post:r,fields:s,images:c,settings:p}=l[i];return(0,e.createElement)("div",{className:"aicp__modal__flex"},(0,e.createElement)("div",{className:"aicp__modal__flex__column0"},(0,e.createElement)("h2",null,(0,a.__)("Preview generation prompts","ai-copilot")),(0,e.createElement)(b,{allowPreview:!0,fields:s,values:p,onChange:o})))}},{label:(0,a.__)("Response","ai-copilot"),name:"response",component:t=>{const{panel:n}=t,{instances:a,selectedInstanceId:o,setCurrentInstanceFields:i,setCurrentInstanceImages:r,multiple:s}=n,{post:c,fields:p,images:m,settings:_}=a[o];return(0,e.createElement)(x,l({values:{...p,..._,images:m},onChange:(e,t)=>{if("image"===e){const e=m.map(e=>({...e,isFeatured:e.src===t}));r(e)}else i({[e]:t})},allowWrite:!s},t))}}],P=(e,t)=>{const n=window.tinymce.get(e),a=document.getElementById(e);n?n.setContent(t):a&&(a.value=t)},F=(R=c,n=>{const i=document.getElementById("post_type")?.value,{post:r,hasResolvedPost:s}=(0,p.usePost)((0,t.getCurrentPostId)(),i),c=e=>{document.getElementById("title").value=e},_=e=>{P("content",e)},d=e=>{P("excerpt",e)},u=e=>{const t=document.querySelector(".ajaxtag input.newtag");t&&(t.value=e)},g=async(e,n,o="",i="")=>{if(t.AICP_IS_FREE)return(0,t.createNotice)((0,a.__)("This is a Premium feature.","ai-copilot"));if(!e)return;const l=tinymce.get("content");l.setMode("readonly");const s=(0,a.__)("Loading image…","ai-copilot"),c=sprintf('<p id="aicp-loading-image">%s</p>',s),p=l.getContent();l.setContent(c+p);const _=l.dom.select('p[id="aicp-loading-image"]')[0],d={url:e,post_id:r?.id||0,caption:o,base64:i},{image_id:u,image_url:g}=await(0,m.fetchRestApiImageUpload)({data:d});let E;E=o?(0,t.getCaptionImageHTML)({image_id:u,image_url:g,position:n,caption:o}):`<img src="${g}" class="align${n}" />`,l.selection.select(_),l.selection.setContent(E),l.setMode("design"),wp.media.featuredImage.set(u)},E=()=>{if(!s)return[];let e="";const t=[];if(document.querySelector("#postimagediv img"))e=document.querySelector("#postimagediv img").src;else{const t=tinymce.get("content").getContent(),n=document.createElement("div");n.innerHTML=t;const a=n.querySelector("img");a&&(e=a.src)}return e&&t.unshift({src:e}),t},h=(0,e.useMemo)(()=>{const e=r?.id||0;return{[e]:{post:{postId:e,postType:i},images:E(),fields:{title:r?.title||"",content:r?.content||"",excerpt:r?.excerpt||"",tags:r?.tagNames?.join(",")||"",sections:(0,t.getPostTypeContentSections)(r?.content)?.join("\n\n")||""}}}},[r]),f={steps:S,instances:h,onWriteTitle:c,onWriteContent:_,onWriteExcerpt:d,onWriteTags:u,onWriteImage:g,onWriteAll:e=>{for(const t in e){const{fields:n,images:a,settings:o}=e[t];if(c(n.title),_(n.content),d(n.excerpt),"post"===!i&&u(n.tags),a.length){const{src:e,caption:t="",base64:n=""}=a.find(e=>e.isFeatured);g(e,o.image_position,t,n)}}}};return s?(0,e.createElement)(R,l({},n,f)):(0,e.createElement)(o.Spinner,null)});var R;(0,t.onDocumentLoaded)(()=>{const t=document.getElementById("ai-copilot-metabox"),n=document.getElementById("ai-copilot-metadata");if(t&&(0,e.render)((0,e.createElement)(F,null),t),n){const t=n.querySelector(".postbox-header").querySelector("h2"),a=document.createElement("span");a.style.setProperty("margin-left","auto","important"),t.appendChild(a),(0,e.render)((0,e.createElement)(i,null),a)}});const O=window.wp.plugins,L=window.wp.editPost,A=window.wp.data,W=window.wp.blocks,k=window.wp.blockEditor,U=n=>i=>{const{post:r,setPost:s}=(0,p.useCurrentPost)(),{setTaxonomyTerms:c}=(0,p.useCurrentPostTaxonomies)(),{insertBlocks:_,removeBlocks:d}=(0,A.useDispatch)(k.store),u=document.getElementById("post_type")?.value,g=e=>t=>{s(e,t)},E=async(e,n,o="",i="")=>{if(t.AICP_IS_FREE)return(0,t.createNotice)((0,a.__)("This is a Premium feature.","ai-copilot"));if(!e)return;const l={url:e,base64:i,post_id:r?.id||0,caption:o},c=(0,W.createBlock)("core/paragraph",{content:(0,a.__)("Loading image…","ai-copilot")});_(c,0);const{image_id:p,image_url:u}=await(0,m.fetchRestApiImageUpload)({data:l}),g=(0,W.createBlock)("core/image",{url:u,caption:o,align:n});_(g,0),d(c.clientId),s("featured_media",p)},h=e=>{const t=e.split(",").map(e=>e.trim().toLowerCase()),n=[...new Set(t)];c("post_tag",n)},f=()=>{let e="";const t=[];if(r?.featured_image_url)e=r?.featured_image_url;else{const t=r?.blocks?.find(e=>"core/image"===e.name);t&&(e=t.attributes.url)}return e&&t.unshift({src:e}),t},b=(0,e.useMemo)(()=>{const e=r?.id||0,n=r?.type;return{[e]:{post:{postId:e,postType:n},images:f(),fields:{title:r?.title||"",content:r?.content||"",excerpt:r?.excerpt||"",tags:r?.tagNames?.join(",")||"",sections:(0,t.getPostTypeContentSections)(r?.content)?.join("\n\n")||""}}}},[r]);if(!r)return(0,e.createElement)(o.Spinner,null);const v={steps:S,instances:b,onWriteTitle:g("title"),onWriteContent:g("content"),onWriteExcerpt:g("excerpt"),onWriteTags:h,onWriteImage:E,onWriteAll:e=>{for(const t in e){const{fields:n,images:a,settings:o}=e[t];if(s("title",n.title),s("content",n.content),s("excerpt",n.excerpt),"post"===!u&&h(n.tags),a.length){const{src:e,caption:t="",base64:n=""}=a.find(e=>e.isFeatured);E(e,o.image_position,t,n)}}}};return(0,e.createElement)(n,l({},i,v))},G=U(c),q=U(t=>{const[n,a]=(0,e.useState)(!1);return(0,e.createElement)(e.Fragment,null,(0,e.createElement)(s,{onClick:()=>a(!0)}),(0,e.createElement)(o.AIPanel,l({},t,{isModalOpen:n,onClose:()=>a(!1)})))});(0,O.registerPlugin)("aicp-sidebar",{render:()=>(0,e.createElement)(L.PluginDocumentSettingPanel,{name:"ai-copilot",title:(0,e.createElement)(e.Fragment,null,(0,e.createElement)("span",null,(0,a.__)("AI Copilot","ai-copilot")),(0,e.createElement)("span",{className:"dashicon dashicons dashicons-admin-tools components-panel__icon"}),(0,e.createElement)("span",{style:{marginLeft:"auto"}},(0,e.createElement)(i,null))),initialOpen:!1},(0,e.createElement)(_.Panel,null,(0,e.createElement)(G,null)))}),(0,t.onDocumentLoaded)(()=>{setTimeout(()=>{const t=document.querySelector(".editor-header__toolbar");if(t){const n=document.createElement("div");t.insertBefore(n,t.lastElementChild),(0,e.createRoot)(n).render((0,e.createElement)(q,null))}},1e3)})})()})();